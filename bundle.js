(()=>{"use strict";const e=new class{constructor(){this.useA=!1;let e=function(e){let t=parseInt(e.substr(0,8),16),a=parseInt(e.substr(8,8),16),n=parseInt(e.substr(16,8),16),i=parseInt(e.substr(24,8),16);return function(){t|=0,a|=0,n|=0,i|=0;let e=(t+a|0)+i|0;return i=i+1|0,t=a^a>>>9,a=n+(n<<3)|0,n=n<<21|n>>>11,n=n+e|0,(e>>>0)/4294967296}};this.prngA=new e(tokenData.hash.substr(2,32)),this.prngB=new e(tokenData.hash.substr(34,32));for(let e=0;e<1e6;e+=2)this.prngA(),this.prngB()}random_dec(){return this.useA=!this.useA,this.useA?this.prngA():this.prngB()}random_num(e,t){return e+(t-e)*this.random_dec()}random_int(e,t){return Math.floor(this.random_num(e,t+1))}random_bool(e){return this.random_dec()<e}random_choice(e){return e[this.random_int(0,e.length-1)]}};function t(){return e.random_dec()}function a(t,a){return t+e.random_dec()*(a-t)}function n(t){return t[Math.floor(e.random_dec()*t.length)]}function i(t){let a=0;const n=e.random_dec(),i=t.reduce(((e,t)=>e+t.probability),0);return t.map((e=>(a+=1*e.probability/i??1,{...e,cumulativeProbability:a}))).find((e=>n<e.cumulativeProbability))??t[t.length-1]}let l,s=!1;const o=(e,a)=>{var n,i,o,r;if(s)n=l,s=!1;else{do{r=(i=t()-1)*i+(o=t()-1)*o}while(r>=1);n=i*(r=Math.sqrt(-2*Math.log(r)/r)),l=o*r,s=!0}return n*(a||1)+(e||0)},r=[{name:"CANYONS",getLayers:()=>{const e={templateDensity:20,templateMagnitude:.02,detailDensity:500,detailMagnitude:.01},a=[],i=n([.15,.85]),l=.3+.4*t(),s=l>.5?.3+.15*t():.7-.15*t(),o=.5+.1*t(),r=o+.15+.15*t();let d,u,p=t()<.5;const h=n([5,6,7,8]);for(let n=0;n<h;n++){null==d?(u=o-(.4+.1*t()),d={top:u,bottom:o}):(d.top=u+(n/(h-1))**1.75*(r-o),d.bottom=o+(n/(h-1))**1.75*(r-o));const c=l+(n/(h-1))**1.75*(s-l);p?a.push({templateGuidelines:[{x:0,y:d.top},t()<i?{x:(.33+.33*t())*c,y:d.top+.25*t()*(d.bottom-d.top)}:void 0,{x:c,y:d.bottom}].filter(Boolean),...e}):a.push({templateGuidelines:[{x:c,y:d.bottom},t()<i?{x:c+(.33+.33*t())*(1-c),y:d.top+.25*t()*(d.bottom-d.top)}:void 0,{x:1,y:d.top}].filter(Boolean),...e}),p=!p}return a}},{name:"CLIFFS",getLayers:()=>{const e={templateDensity:10,templateMagnitude:.04,detailDensity:200,detailMagnitude:.008},a=o(.25,.05),n=a-(.05+Math.abs(o(0,.075))),i=a+Math.abs(o(0,.075)),l=i-(.05+Math.abs(o(0,.075))),s=.1+.8*t(),r=Math.max(s-(.2+Math.abs(o(0,.15))),0),d=Math.min(s+(.2+Math.abs(o(0,.15))),1),u=.1+.8*t(),p=Math.max(u-(.1+Math.abs(o(0,.15))),0),h=Math.min(u+(.1+Math.abs(o(0,.15))),1),c=[];r>0&&c.push({x:0,y:a}),c.push({x:r,y:a}),c.push({x:s,y:n}),c.push({x:d,y:a}),d<1&&c.push({x:1,y:a});const g=[];p>0&&g.push({x:0,y:i}),g.push({x:p,y:i}),g.push({x:u,y:l}),g.push({x:h,y:i}),h<1&&g.push({x:1,y:i});const y=[{templateGuidelines:c,...e,layerHeight:.5},{templateGuidelines:g,...e,detailMagnitude:2*e.detailMagnitude,layerHeight:.5}],m=t(),b=.45,f=.05;let M;if(m<.667&&(M=.1+.7*t(),y.push({templateGuidelines:[{x:0,y:o(b,f)},{x:Math.max(M-(.075+Math.abs(o(0,.05))),0),y:o(b,f)},{x:M,y:o(.75,f)}],...e,templateDensity:Math.round(2*e.templateDensity),templateMagnitude:1.2*e.templateMagnitude,detailMagnitude:3*e.detailMagnitude})),m>.333){const a=null!=M?M+.1+t()*(.9-(M+.1)):1-(.1+.5*t());y.push({templateGuidelines:[{x:a,y:o(.75,f)},{x:Math.min(a+(.075+Math.abs(o(0,.05))),1),y:o(b,f)},{x:1,y:o(b,f)}],...e,templateDensity:Math.round(2*e.templateDensity),templateMagnitude:1.2*e.templateMagnitude,detailMagnitude:3*e.detailMagnitude})}return y}},{name:"PEAKS",getLayers:()=>{const e={templateDensity:20,templateMagnitude:.06,detailDensity:300,detailMagnitude:.01};let a=0;const n=1-.9*(.75+.25*t()),i=.4+.2*t(),l=i-.05+Math.abs(o(0,.2)),s=i+.05-Math.abs(o(0,.2)),r=i-(.15+Math.abs(o(0,.2))),d=i+(.15+Math.abs(o(0,.2))),u=[],p=(.33+.33*t())*l;let h,c;for(a=0;++a<50&&(h=1-(.8+.2*t())*(1-n),!((1-h)/((l-p)*A)<=1)););for(a=0;++a<50&&(c=n+(.5+.25*t())*(1-n),!((c-h)/(p*A)<=1)););u.push({templateGuidelines:[{x:0,y:c},{x:p,y:h},{x:l,y:1}],...e});const g=s+(.33+.33*t())*(1-s);let y,m,b;for(a=0;++a<50&&(y=1-(.8+.2*t())*(1-n),!((1-y)/((g-s)*A)<=1)););for(a=0;++a<50&&(m=n+(.5+.25*t())*(1-n),!((m-y)/((1-g)*A)<=1)););for(u.push({templateGuidelines:[{x:s,y:1},{x:g,y},{x:1,y:m}],...e}),a=0;++a<50;){b=1-(.25+.75*t())*(1-n);const e=(1-b)/((i-r)*A),a=(1-b)/((d-i)*A);if(e<=1&&e>=.66&&a<=1&&a>=.66)break}return u.push({templateGuidelines:[{x:r,y:1},{x:i,y:b},{x:d,y:1}],...e,templateDensity:15,templateMagnitude:.1,detailMagnitude:.0045}),u}},{name:"PLAINS",getLayers:()=>{const e={templateDensity:20,templateMagnitude:.02,detailDensity:200,detailMagnitude:.002},a=.05,i=a+.3*t(),l=n([3,4]),s=[o(.4,.05)];for(let e=1;e<l;e++)s.push(s[e-1]+Math.abs(o(.05,.025)));const r=s[s.length-1],d=n([0,1,2]),u=r+(d>0?Math.abs(o(.05,.025)):0);let p,h;2===d?t()<.5?(p=u,h=u+t()*(i-a)):(p=u+t()*(i-a),h=u):1===d&&(t()<.5?p=u:h=u);const c=s.map(((t,a)=>({templateGuidelines:[{x:0,y:t},{x:1,y:t}],...e,templateDensity:e.templateDensity+5*a,detailMagnitude:e.detailMagnitude+5e-4*a,layerHeight:i+u-t}))),g={...e,templateDensity:e.templateDensity+5*s.length,detailMagnitude:e.detailMagnitude+5e-4*s.length};if(null!=p){const e=()=>.2+.5*t();c.push({templateGuidelines:[{x:0,y:p},{x:e(),y:u+i}],...g}),t()<.2&&c.push({templateGuidelines:[{x:0,y:p+t()*(u+(i-a)-p)},{x:e(),y:u+i}],...g})}if(null!=h){const e=()=>1-(.2+.5*t());c.push({templateGuidelines:[{x:e(),y:u+i},{x:1,y:h}],...g}),t()<.2&&c.push({templateGuidelines:[{x:e(),y:u+i},{x:1,y:h+t()*(u+(i-a)-h)}],...g})}return c}},{name:"PLAINS_MOUNTAINS",getLayers:()=>{const e={templateDensity:20,templateMagnitude:.04,detailDensity:200,detailMagnitude:.005},a=.1+.1*t();let n,i;for(;n=o(.5,.05),i=o(.5,.05),!(Math.abs(n-i)<a/3););const l=Math.max(n,i)+a;let s=0;const r=[];r.push({templateGuidelines:[{x:0,y:n},{x:.35+.3*t(),y:Math.min(n,i)-(.1+.1*t())},{x:1,y:i}],...e,templateDensity:e.templateDensity+5*s,detailMagnitude:e.detailMagnitude+5e-4*s,layerHeight:l-Math.max(n,i)}),s++;const d=n+Math.abs(o(0,.05)),u=i+Math.abs(o(0,.05));r.push({templateGuidelines:[{x:0,y:d},{x:1,y:u}],...e,templateDensity:e.templateDensity+5*s,detailMagnitude:e.detailMagnitude+5e-4*s,layerHeight:l-Math.max(u,u)}),s++;const p=.35+.3*t(),h=n+Math.max(Math.abs(o(0,.05)),a/3);r.push({templateGuidelines:[{x:0,y:h},{x:p-Math.abs(o(0,.1)),y:h+Math.abs(o(0,.025))},{x:p+(.05+Math.abs(o(0,.1))),y:l}],...e,templateDensity:e.templateDensity+5*s,detailMagnitude:e.detailMagnitude+5e-4*s,layerHeight:l-h});const c=n+Math.max(Math.abs(o(0,.05)),a/3);return r.push({templateGuidelines:[{x:p-(.05+Math.abs(o(0,.1))),y:l},{x:p+Math.abs(o(0,.1)),y:c+Math.abs(o(0,.025))},{x:1,y:c}],...e,templateDensity:e.templateDensity+5*s,detailMagnitude:e.detailMagnitude+5e-4*s,layerHeight:l-c}),r}}],d=[{name:"Icy",canvas:[198,32,94],border:[198,32,94],bg:[198,26,76],bgAlphas:[.5,1],fg:[[187,50,83],[198,100,41],[208,97,18]]},{name:"Blue Capped",canvas:[215,17,26],border:[215,17,26],bg:[215,38,16],bgAlphas:[.5,1],fg:[[5,16,46],[37,77,49],[204,21,75]]},{name:"Ramblin Frank",canvas:[353,36,28],border:[353,36,28],bg:[353,32,40],bgAlphas:[.5,1],fg:[[4,85,61],[33,100,75],[185,30,51]]},{name:"Earthenware",canvas:[16,67,79],border:[16,67,79],bg:[32,100,90],bgAlphas:[.5,1],fg:[[185,48,45],[350,40,50]]},{name:"Golden Hour",canvas:[30,50,97],border:[30,50,97],bg:[32,99,68],bgAlphas:[.5,1],fg:[[3,99,68],[348,100,82],[350,40,50]]},{name:"Goldilocks",canvas:[30,74,95],border:[30,74,95],bg:[32,99,68],bgAlphas:[.25,1],fg:[[32,99,68]]},{name:"Carpathian Slate",canvas:[345,40,97],border:[345,40,97],bg:[215,19,41],bgAlphas:[.25,1],fg:[[215,19,41]]},{name:"Pink Paper",canvas:[344,100,96],border:[344,100,96],bg:[344,100,90],bgAlphas:[1,1],fg:[[344,100,74],[344,94,51],[344,85,36]]},{name:"Arctic Night",canvas:[203,56,8],border:[203,56,8],bg:[236,100,65],bgAlphas:[.25,1],fg:[[172,90,55],[293,55,68]]},{name:"Flameback",canvas:[5,99,96],border:[5,99,96],bg:[2,100,84],bgAlphas:[.25,1],fg:[[2,100,78],[12,95,74]]},{name:"Blackboard",canvas:[0,0,20],border:[0,0,20],bg:[0,0,64],bgAlphas:[.25,1],fg:[[0,0,96]]},{name:"Lilac Roller",canvas:[272,100,97],border:[272,100,97],bg:[271,60,88],bgAlphas:[.5,1],fg:[[217,51,78],[270,24,59],[357,49,64]]},{name:"All The Wine",canvas:[350,40,50],border:[350,40,50],bg:[350,45,40],bgAlphas:[1,1],fg:[[0,0,100]]},{name:"Colonel Mustard",canvas:[32,99,68],border:[32,99,68],bg:[236,100,65],bgAlphas:[.5,1],fg:[[236,100,65]]},{name:"Newspaper",canvas:[12,100,97],border:[12,100,97],bg:[0,0,20],bgAlphas:[.25,1],fg:[[0,0,20]]},{name:"Phoenix",canvas:[252,5,21],border:[252,5,21],bg:[252,8,16],bgAlphas:[.5,1],fg:[[12,52,47],[289,8,38]]},{name:"Greenwash",canvas:[158,26,46],border:[158,26,46],bg:[188,19,38],bgAlphas:[.5,1],fg:[[38,48,88],[114,26,71],[225,46,28]]},{name:"Bubblegum Forest",canvas:[324,91,75],border:[324,91,75],bg:[336,49,81],bgAlphas:[.5,1],fg:[[184,36,29],[264,49,65],[286,24,46]]},{name:"Sailaway",canvas:[360,18,97],border:[360,18,97],bg:[224,37,76],bgAlphas:[.5,1],fg:[[0,0,17],[33,88,71],[226,12,56]]},{name:"Sunset Drive",canvas:[40,1,20],border:[40,1,20],bg:[255,10,8],bgAlphas:[.5,1],fg:[[20,75,60],[207,32,45],[357,41,51]]}],u=n([-1,1]),p=n([10,30,90]),h=n([-1,1]),c=[{name:"CLASSIC",xDistortion:1,yDistortion:1,xDensity:400,yDensity:300,edgeYDistortion:3,alphaDropoffRate:1,xDisplacement:()=>0,backgroundAlphaIndex:1,disallowedLandscapes:["PEAKS"],probability:.25},{name:"SINE",xDistortion:4,yDistortion:1,xDensity:400,yDensity:300,edgeYDistortion:0,alphaDropoffRate:2,xDisplacement:(e,t,a,n)=>n?0:u*Math.sin(e/p)*e/450,backgroundAlphaIndex:0,disallowedLandscapes:["NORTHERN_LIGHTS","PEAKS"],probability:.1},{name:"CHALK",xDistortion:4,yDistortion:1,xDensity:400,yDensity:300,edgeYDistortion:0,alphaDropoffRate:1,xDisplacement:(e,a,i,l)=>l?0:h*n([-4,-2,-1,1])*Math.sin(50*t()/25)*e/2e3,backgroundAlphaIndex:0,disallowedLandscapes:[],probability:.4},{name:"THICK",xDistortion:1,yDistortion:1,xDensity:30,yDensity:8e3,edgeYDistortion:0,alphaDropoffRate:2,xDisplacement:()=>0,backgroundAlphaIndex:1,disallowedLandscapes:["NORTHERN_LIGHTS"],probability:.15},{name:"THIN",xDistortion:.5,yDistortion:1,xDensity:75,yDensity:1e3,edgeYDistortion:0,alphaDropoffRate:1,xDisplacement:()=>0,backgroundAlphaIndex:1,disallowedLandscapes:["NORTHERN_LIGHTS","PEAKS"],probability:.1}];function g(e,t,a,n,i,l,s){const o=[i-e,l-t],r=[a-e,n-t],d=y(r,r);let u=y(o,r)/d;u=u<0?0:u,u=u>1?1:u;const p=[r[0]*u+e-i,r[1]*u+t-l];return y(p,p)<=s*s}function y(e,t){return e[0]*t[0]+e[1]*t[1]}function m(e,t,a,n,i,l,s,o){const r=a-e,d=n-t,u=s-i,p=o-l,h=(-d*(e-i)+r*(t-l))/(-u*d+r*p),c=(u*(t-l)-p*(e-i))/(-u*d+r*p);return h>=0&&h<=1&&c>=0&&c<=1}function b(e,t,a){if("NONE"===T.type)return!1;if(["SUN","SUN_RINGED"].includes(T.type)){const n=Math.sqrt((e-T.center.x*A)**2+(t-T.center.y)**2);if(!a)return!1;if(n<=T.radius)return!0;for(let e=1;e<=T.haloCount;e++){const t=.05-(e-1)*(.05/T.haloCount);if(n>=T.radius*(1+.2*e-t/2)&&n<=T.radius*(1+.2*e+t/2))return!0}return!1}const n=Math.sqrt((e-T.center.x*A)**2+(t-T.center.y)**2),i=T.radius*{MOON_CRESCENT:1.25,MOON_HALF:5,MOON_ECLIPSE:1.01}[T.type],l=2*Math.PI*20/360,s=T.center.x*A+Math.sqrt(i**2-T.radius**2)*Math.cos(l),o=T.center.y-Math.sqrt(i**2-T.radius**2)*Math.sin(l),r=Math.sqrt((e-s)**2+(t-o)**2);return!!a&&(n<=T.radius&&r>i||n<=T.radius&&n>=.9833333333333333*T.radius)}parseInt(new URLSearchParams(window.location.search).get("size")??0,10);const f=new URLSearchParams(window.location.search).get("technique"),M=Math.floor(t()*d.length);let x=Math.min(window.innerWidth,window.innerHeight);const D=()=>x,v=16/9,I=1,A=1.8454106280193234,L=.04,G=d[M],w=n(d.filter(((e,t)=>t!==M))),R=i([{value:"LAYER",probability:.4},{value:"LERP_WIDTH",probability:.3},{value:"LERP_DOUBLE_WIDTH",probability:.3}]).value,S=c.find((e=>e.name===f))??i(c),E=["CITY","THIN"].includes(S.name)?"REGULAR":i([{value:"REGULAR",probability:.75},{value:"DIPTYCH",probability:.05},{value:"DIPTYCH_LEFT",probability:.05},{value:"DIPTYCH_RIGHT",probability:.05},{value:"TRIPTYCH",probability:.05},{value:"TRIPTYCH_ASYM",probability:.05}]).value;G.bg[3]=G.bgAlphas[S.backgroundAlphaIndex],w.bg[3]=w.bgAlphas[S.backgroundAlphaIndex];const N=n(r.filter((e=>!S.disallowedLandscapes.includes(e.name)))),k=t()<.2,H=.1678,_=.25,P=N.isInverted?0:i([{value:0,probability:.8},{value:.2,probability:.15},{value:.4,probability:.05}]).value,T=function(e){const a={.4:0,.2:.4,0:.7}[P],l=i([{value:"NONE",probability:a},{value:"SUN",probability:(1-a)/3},{value:"SUN_RINGED",probability:(1-a)/3},{value:"MOON_CRESCENT",probability:(1-a)/6},{value:"MOON_ECLIPSE",probability:(1-a)/6}]).value;if("NONE"===l)return{type:l};const s=Math.max(...e.map((e=>e.templateGuidelines.map((e=>e.y)))).flat()),o="SUN_RINGED"===l?5:0;let r,d,u,p=0;e:for(;++p<100;){const a=["SUN","SUN_RINGED"].includes(l);u=n(a?[.1,.2,.3]:[.1,.2]),d=a?t()*s:u/1+.3*t()*(1-2*u/1),r=a?t():u/A+t()*(1-2*u/A);for(const t of e)for(let e=0;e<t.templateGuidelines.length-1;e++){const{x:n,y:i}=t.templateGuidelines[e],{x:l,y:s}=t.templateGuidelines[e+1];if(g(n*A,1*i,l*A,1*s,r*A,1*(d-u*(a?.4:0)),u))continue e;if(n<=r&&l>=r&&!m(n*A,1*i,l*A,1*s,r*A,1*d,r*A,1))continue e}break}return 100===p?{type:"NONE"}:{type:l,radius:u,center:{x:r,y:d},haloCount:o,density:1}}(N.getLayers().map((e=>({...e,templateGuidelines:e.templateGuidelines.map((({x:e,y:t})=>({x:e,y:t+P})))})))),C={REGULAR:[],DIPTYCH:[.5],DIPTYCH_LEFT:[1/3],DIPTYCH_RIGHT:[2/3],TRIPTYCH:[1/3,2/3],TRIPTYCH_ASYM:[.2,.8]};function B(e,t){{if(e<0||e>A||t<0||t>1)return!0;const a=L*A/v;for(const t of C[E])if(e+a/2>(A+a)*t-a/2&&e+a/2<(A+a)*t+a/2)return!0}return!1}function Y(e){e.noStroke(),e.fill(...G.border),e.rect(...[0,0,v,L].map((e=>e*D()))),e.rect(...[0,0,L,I].map((e=>e*D()))),e.rect(...[v,I,-v,-L].map((e=>e*D()))),e.rect(...[v,I,-L,-I].map((e=>e*D())));for(const t of C[E]){const a=L/2+t*(v-L)-L/2;e.rect(...[a,0,L,I].map((e=>e*D())))}}const O=()=>{const e={templateDensity:1,templateMagnitude:0,detailDensity:1,detailMagnitude:0,layerHeight:.7,isBackground:!0};return[{templateGuidelines:[{x:0,y:0},{x:1,y:0}],...e},{templateGuidelines:[{x:0,y:0},{x:1,y:0}],...e,isInverted:!0}]},U=(parseInt(new URLSearchParams(window.location.search).get("size")??0,10),new URLSearchParams(window.location.search).get("guidelines")),F=(parseInt(new URLSearchParams(window.location.search).get("downloadIndex")??0,10),"true"===U);new URLSearchParams(window.location.search).get("technique");let q=0;new p5((e=>{let i,l,s=1;const o=[];function r(e){const a=t()<.2?e.bg:n(e.fg),i="LERP_DOUBLE_WIDTH"===R||t()<.5,l=e.fg.filter((e=>e.join(",")!==a.join(","))),s=l.filter((e=>(i?e[0]-a[0]:a[0]-e[0])<180));return s.length>0?i?[a,n(s)]:[n(s),a]:l>0?i?[a,n(l)]:[n(l),a]:[a,a]}function d(e,t,a){let[n,i,l,s]=e,[o,r,d,u]=t;Math.abs(n-o)>180&&(n<o?n+=360:o+=360);const p=[(n+a*(o-n))%360,i+a*(r-i),l+a*(d-l)];return null==s&&null==u||p.push((s??1)+a*((u??1)-(s??1))),p}e.setup=()=>{e.randomSeed(1e3*t()),e.noiseSeed(1e3*t()),e.noiseDetail(2),console.log(tokenData),e.createCanvas(v*D(),I*D()),e.colorMode(e.HSL),e.angleMode(e.DEGREES),e.noStroke(),console.log(1,H),i=new Array(Math.ceil(A/H)).fill(0).map((e=>new Array(Math.ceil(1/H)).fill(0).map((e=>t())))),l=[...O(),...N.getLayers().map((e=>({...e,templateGuidelines:e.templateGuidelines.map((({x:e,y:t})=>({x:e,y:t+P})))})))];for(let e=0;e<l.length;e++){const n=l[e],i={template:[],detail:[],columnLayers:[],height:n.layerHeight??0,isBackground:n.isBackground,isInverted:n.isInverted},s=A/n.templateDensity;i.template=new Array(n.templateDensity+1).fill(void 0);for(const{x:e,y:t}of n.templateGuidelines)i.template[Math.round(e*n.templateDensity)]={x:Math.round(e*n.templateDensity)/n.templateDensity*A,y:t,isGuideline:!0};for(let e=0;e<i.template.length;e++){const t=e*s;if(null==i.template[e]){const l=n.templateGuidelines.findIndex((t=>t.x>e/n.templateDensity))-1,s=n.templateGuidelines[l];if(null==s)continue;const o=n.templateGuidelines[l+1];if(null==o)continue;const r=s.y+(o.y-s.y)*(t-s.x*A)/(o.x*A-s.x*A);let d;for(;;){if(n.isBackground){d=r;break}if(d=r+a(-n.templateMagnitude,n.templateMagnitude),s.y===o.y)break;if(!(d>=Math.max(s.y,o.y)||d<=Math.min(s.y,o.y)))break}i.template[e]={x:t,y:d}}}i.template=i.template.filter(Boolean);let r,d=i.template[0].y;for(let e=1;e<i.template.length;e++){r=i.template[e].y;const t=i.template[e].x,l=Math.round(n.detailDensity/n.templateDensity),o=s/l;for(let s=0;s<l;s++){const l=i.template[e-1].x+s*o;i.detail.push({x:l,y:d});const u=o*(r-d)/(t-l);d+=a(u-n.detailMagnitude,u+n.detailMagnitude)}}i.detail.push({x:i.template[i.template.length-1].x,y:d});for(let n=0;n<3;n++){const n=[],l=Math.min(...i.detail.map((e=>e.y))),s=Math.max(...i.detail.map((e=>e.y))),o=!N.isInverted||i.isBackground?Math.min(s+i.height,1):Math.max(l-i.height,0),r=1/S.xDensity,d=Math.round(i.detail[0].x*S.xDensity/A),u=Math.round(i.detail[i.detail.length-1].x*S.xDensity/A)-d;for(let s=0;s<u;s++){const p=(d+s)*r*A,h=(i.detail.length-1)*s/(u-1)%1,c=Math.floor((i.detail.length-1)*s/(u-1)),g=Math.ceil((i.detail.length-1)*s/(u-1));let y,m;i.isBackground?i.isInverted?(y=1-i.height+a(-.3,.3),m=1):(y=0,m=i.height+a(-.3,.3)):(y=i.detail[c].y+h*(i.detail[g].y-i.detail[c].y),m=N.isInverted?o-(1-o)*t():m=o+(1-o)*t());const b=!N.isInverted||i.isBackground?Math.round(S.yDensity*(m-y))*1.25**e:Math.round(S.yDensity*(y-m))*1.25**e,f=!N.isInverted||i.isBackground?1/(b-1)*(m-y):1/(b-1)*(y-m);y+=a(-S.edgeYDistortion*f,S.edgeYDistortion*f);const M=[];for(let e=0;e<b;e++){const t=!N.isInverted||i.isBackground?y+e*f+f*a(-S.yDistortion/2,S.yDistortion/2):y-e*f+f*a(-S.yDistortion/2,S.yDistortion/2),n=p+(r/2+r*a(.5*-S.xDistortion,.5*S.xDistortion)+S.xDisplacement(e,t,l,i.isBackground))*A;B(n,t)||M.push({x:n,y:t})}n.push(M)}i.columnLayers.push(n)}o.push(i)}},e.draw=()=>{!function(a,l){if(l.loop(),l.background(...G.canvas),Y(l),a<=2)return l.fill(...n(G.fg)),l.textSize(32),l.textFont("Monospace"),void l.text("Prototype loading...",v/2*D()-180,I/2*D());const s=e.shuffle(r(G),!0),u=e.shuffle(r(w),!0);if(k)for(let e=0;e<i.length;e++)for(let t=0;t<i[0].length;t++)l.fill(...i[e][t]<_?w.canvas:G.canvas),l.rect((L+(v-2*L)*e/(A/H))*D(),(L+(I-2*L)*t/(1/H))*D(),1*(v-2*L)/(A/H)*D(),1*(v-2*L)/(A/H)*D());for(let a=0;a<o.length;a++){const r=o[a],p=r.isBackground?G.bg:n(G.fg),h=r.isBackground?w.bg:n(w.fg);e.noStroke();for(const e of r.columnLayers)for(let a=0;a<e.length;a++)for(let n=0;n<e[a].length;n++){const{x:o,y:c}=e[a][n];if(b(o,c,r.isBackground)&&t()<T.density)continue;const g=Math.floor(o/H),y=Math.floor(c/H),m=r.isBackground?1:((e[a].length-n)/e[a].length)**S.alphaDropoffRate;if(m>.001){let e;if("LAYER"===R)e=l.color(...k&&i[g][y]<_?h:p);else if("LERP_WIDTH"===R){const t=k&&i[g][y]<_?u:s;e=r.isBackground?l.color(...k&&i[g][y]<_?w.bg:G.bg):d(t[0],t[1],o/A)}else if("LERP_DOUBLE_WIDTH"===R){const t=k&&i[g][y]<_?u:s;e=r.isBackground?l.color(...k&&i[g][y]<_?w.bg:G.bg):d(t[o/A<.5?0:1],t[o/A<.5?1:0],o/A<.5?o/(A/2):(o-A/2)/(A/2))}l.fill(l.hue(e),l.saturation(e),l.lightness(e),l.alpha(e)*m),l.ellipse((L+(1-2*L/v)*v/A*o)*D(),(L+(1-2*L/I)*I/1*c)*D(),.001*D()),q++}}}if(F)for(const e of o){l.canvas.getContext("2d").fillStyle="#ff0000";for(const{x:t,y:a,isGuideline:n}of e.template)l.ellipse(t*D(),a*D(),n?20:5)}k&&Y(l),l.noLoop(),console.log("done",q)}(s,e),s++},e.windowResized=()=>{var t;s=1,t=Math.min(window.innerWidth,window.innerHeight),x=t,e.resizeCanvas(v*D(),I*D())},e.keyPressed=()=>{const t={48:0,49:.25,50:.5,51:.75,52:1}[e.keyCode];null!=t&&(k=!0,_=t,s=1,console.log(`Setting glitch percentage to ${Math.round(100*t)}%`),e.loop())}}))})();